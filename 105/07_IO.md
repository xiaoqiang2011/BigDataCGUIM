¸ê®ÆÅª¨ú»P¶×¥X
========================================================
author: ´¿·N¾§ Yi-Ju Tseng
date: 2017/03/20 & 27
autosize: true
font-family: 'Microsoft JhengHei'
navigation: slide

¹ïÀ³®Ñ¥»³¹¸`
========================================================
[4 ¸ê®ÆÅª¨ú»P¶×¥X](http://yijutseng.github.io/DataScienceRBook/io.html)

¤jºõ
====================================
- ±qÀÉ®×¶×¤J
- ±qºô¸ô¶×¤J
- ±qFacebook¶×¤J
- ¸ê®Æ¶×¥X

¸ê®Æ¤ÀªR¨BÆJ
====================================
- **¸ê®Æ¶×¤J** <-----¥»³¹¡I
- **¸ê®Æ²M¬~³B²z**¨ÃÂà´«¬°Tidy data
- **¸ê®Æ¤ÀªR**
- **¸ê®Æ§e²{»PµøÄ±¤Æ**

±qÀÉ®×¶×¤J
====================================
type:section
- Import Dataset¥\¯à (RStudio)
- ¤À¹j¤å¦rÀÉ .txt
- CSVÀÉ®× .csv
- ExcelÀÉ®× .xls
- Rª«¥ó .rds
- Rµ{¦¡ .R
- ¯Â¤å¦r¸ê®Æ (µL¤À¹j)
- ¨ä¥L®æ¦¡

Import Dataset¥\¯à (RStudio)
====================================
¿ï¨úRStudio¥|¤À³Îµøµ¡¥k¤W¨¤ªºEnvironment¼ÐÅÒ¡A¿ï¾Ü**Import Dataset**

![plot of chunk unnamed-chunk-1](figures/import.png)

Import Dataset¥\¯à (RStudio)
====================================
- ¿ï¨ú`From CSV`
- ÂI¿ï`Browse`«ö¶s¶}±ÒÀÉ®×¿ï¨ú¾¹

![plot of chunk unnamed-chunk-2](figures/csv.png)

Import Dataset¥\¯à (RStudio)
====================================
- §Q¥Î¤U¤è`Import Options`ªº¿ï¶µ·L½Õ°Ñ¼Æ
    - `Delimiter`¤À¹j²Å¸¹
    - `First Row as Names`­º¦C¬O§_¬°Äæ¦ì¦WºÙ
    
![plot of chunk unnamed-chunk-3](figures/csv2.png)

Import Dataset¥\¯à (RStudio)
====================================
type:alert
incremental:true

- ¾Þ§@[½d¨ÒÀÉ®×](https://raw.githubusercontent.com/CGUIM-BigDataAnalysis/BigDataCGUIM/master/104/POLIO_Incidence.csv)
- ­Y¶×¤JªºÀÉ®×¬°**tab¤À¹j¤å¦rÀÉ**? ¸Ó¦p¦ó½Õ¾ã°Ñ¼Æ¡H

¤À¹j¤å¦rÀÉ .txt
====================================
type:sub-section

- `readr` package´£¨Ñ§¹¾ãªº¤å¦rÀÉÅª¨ú¥\¯à
- ¦UÅª¨ú¨ç¼Æªº²Ä¤@­Ó°Ñ¼Æ³q±`¬°**ÀÉ®×¸ô®|»P¦WºÙ**
- `read_delim()`¨ç¼Æ¡G¥Î¤À¹j²Å¸¹¤À¹jªº¤å¦rÀÉ®×
    - `delim`=`\t`¡Atab¤À¹jÀÉ®×
    - `col_names`¡GTRUE¥Nªí¸ê®Æ¤º¦³¥]§tÄæ¦ì¦WºÙ(­º¦C)
        - ¦pªG¬°FALSE¡AÄæ¦ì¦WºÙ«h·|³Q³]©w¬° X1, X2, X3 ...
    
TAB¤À¹j¤å¦rÀÉ .txt
====================================

```r
library(readr) 
#²Ä¤@¦¸¨Ï¥Î«e»Ý­n¦w¸Ë install.packages("readr")
dataset <- read_delim("ÀÉ®×¸ô®|»P¦WºÙ", delim="\t")
```

CSVÀÉ®× .csv
====================================
type:sub-section
- `readr` package
- `read_csv()`

```r
library(readr)
#²Ä¤@¦¸¨Ï¥Î«e»Ý­n¦w¸Ë install.packages("readr")
dataset <- read_csv("ÀÉ®×¸ô®|»P¦WºÙ")
```


ExcelÀÉ®× .xls
====================================
type:sub-section
- `readxl` package
- `read_excel()`¨ç¼Æ
    - `col_names`°Ñ¼Æ¥~
    - `sheet`°Ñ¼Æ³]©w­nÅª¨úªº¤u§@ªí(sheet)

```r
library(readxl)
#²Ä¤@¦¸¨Ï¥Î«e»Ý­n¦w¸Ë install.packages("readxl")
dataset <- read_excel("ÀÉ®×¸ô®|»P¦WºÙ")
```

ÀÉ®×¶×¤J½m²ß
====================================
type:alert
incremental:true

- ¤U¸ü[½d¨ÒCSVÀÉ®×](https://raw.githubusercontent.com/yijutseng/BigDataCGUIM/master/files/opendata10401.csv)¡A¨Ã¦bRStudio¶×¤J
    - ¤èªk¤@
    - ¤èªk¤G
- ¶×¤J«á¡AÀË¬d¶×¤Jªº¸ê®Æ¡A¸ê®Æ¤º¦³´Xµ§Æ[¹î­È¡H¨Cµ§Æ[¹î­È¤¤¦³´X­ÓÄæ¦ì¡H

Rª«¥ó .rds
====================================
type:sub-section
¦pªG¦bRµ{¦¡¤º³B²z§¹¸ê®Æ«á¡A¥²¶·Àx¦s¤@¥÷¥H¨Ñ«áÄò¤ÀªR¡A¨Ï¥ÎRª«¥óÀx¦s¬O³Ì¨Îªº¤è¦¡

- ÀÉ®×¤p
- Åª¨ú§Ö³t
- ±ÀÂË¨Ï¥Î`readRDS()`¨ç¼ÆÅª¨úRDSÀÉ®×
- [A better way of saving and loading objects in R](http://www.fromthebottomoftheheap.net/2012/04/01/saving-and-loading-r-objects/)

```r
dataset <- readRDS("ÀÉ®×¸ô®|»P¦WºÙ")
```

Rµ{¦¡ .R
====================================
type:sub-section
- `source`¨ç¼Æ
- ÅªRªºObejct or script, **°õ¦æ**
- **¹ê»Ú¾Þ§@½d¨Ò**
    - ¦³¤@¥÷example.RÀÉ¦b¤u§@Àô¹Ò¤¤
    - ¨Ï¥Îsource("example.R")¤@¦¸°õ¦æÀÉ®×¤º©Ò¦³R«ü¥O

¯Â¤å¦r¸ê®Æ (µL¤À¹j)
====================================
type:sub-section
`readLines`, ³v¦æÅª¨ú¤å¦r¸ê®Æ

¨ä¥L®æ¦¡ (³z¹L¸ü¤J®M¥ó)
====================================
type:sub-section

- MySQL `RMySQL`
- Weka `foreign`
- Stata `foreign`
- SPSS `Hmisc`
- SAS `Hmisc`
- GIS `rgdal`
- Images `jpeg`
- Music `tuneR`


¨ä¥LÅªÀÉª`·N¨Æ¶µ
====================================
type:sub-section

ÅªÀÉªº®É­ÔR·|¦Û°Ê:

- §PÂ_­nÅª´X¦æ
- §PÂ_¨C­Ó¦C¡]Column¡^ªºÃþ§O
- §âÄæ¦ì¥]°_¨Óªº²Å¸¹

¦pªGÅª¨ú®É¤w«ü©w**ColumnÃþ§O**¥H¤Î**§âÄæ¦ì¥]°_¨Óªº²Å¸¹**¡AÅª¨ú³t«×·|§Ö«Ü¦h¡C

±qºô¸ô¶×¤J
====================================
type:section
- Open Data
- API (Application programming interfaces)
- JSON®æ¦¡ÀÉ®×
- XML ¥i©µ¦ù¼Ð°O¦¡»y¨¥
- ºô­¶ª¦ÂÎ Webscraping

Open Data ¶}©ñ¸ê®Æ
====================================
type:sub-section
- 2011¦~±À°Ê¶}©ñ¬F©²»P¶}©ñ¸ê®Æ ([ºû°ò¦Ê¬ì](https://zh.wikipedia.org/wiki/%E9%96%8B%E6%94%BE%E8%B3%87%E6%96%99))
- ¤£¨üµÛ§@Åv¡B±M§QÅv¡A¥H¤Î¨ä¥LºÞ²z¾÷¨î©Ò­­¨î¡A¥ô¦ó¤H³£¥i¥H¦Û¥Ñ¥Xª©¨Ï¥Î
- ±`¨£ªºÀx¦s¤è¦¡¬°: 
    - `CSV`
    - `JSON`
    - `XML`
    
Open Data ¶}©ñ¸ê®Æ±`¨£¥­¥x
====================================
- [¬F©²¸ê®Æ¶}©ñ¥­¥x](http://data.gov.tw/)
- [Data Taipei](http://data.taipei/)
- [¶}©ñ¸ê®Æ x ¶}©ñ®ç¶é](http://data.tycg.gov.tw/)
- [¤º¬F¸ê®Æ¶}©ñ¥­¥x](http://data.moi.gov.tw/)


API
====================================
type:sub-section
- À³¥Îµ{¦¡¤¶­±
- **A**pplication **P**rogramming **I**nterfaces
- ¬°¤FÅý²Ä¤T¤èªº¶}µoªÌ¥i¥HÃB¥~¶}µoÀ³¥Îµ{¦¡¨Ó±j¤Æ¥L­Ìªº²£«~¡A±À¥X¥i¥H»P¨t²Î·¾³qªº¤¶­±
- ¦³API»²§U¥i±N¸ê®ÆÂ^¨ú¹Lµ{¦Û°Ê¤Æ
    -  ¥H¤U¸üOpen Data¬°¨Ò¡A­YÀÉ®×§ó·sÀWÁc¡A¨Ï¥Î¤â°Ê¤U¸ü¬Û·í¯Ó®É
- [ºû°ò¦Ê¬ì](https://zh.wikipedia.org/zh-tw/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%8E%A5%E5%8F%A3)

API - Open Data
====================================
- [»O¥_¥«¶}©ñ»{¾i°Êª«](http://data.taipei/opendata/datalist/datasetMeta?oid=6a3e862a-e1cb-4e44-b989-d35609559463)¸ê®Æ
- ¨C¤é§ó·s
- ¤£¥i¯à¨C¤é¤â°Ê¤U¸ü
- ´£¨Ñ³z¹L**API**¤U¸üªºªA°È
- ³z¹LAPI¤U¸üªº¸ê®Æ®æ¦¡: **JSON®æ¦¡**

***

- [»O¥_¥«¶}©ñ»{¾i°Êª«API¸ê°T](http://data.taipei/opendata/datalist/datasetMeta/outboundDesc?id=6a3e862a-e1cb-4e44-b989-d35609559463&rid=f4a75ba9-7721-4363-884d-c3820b0b917c)
    - **¸ê®Æ¶°ID**: ¬ö¿ý¸ê®Æªº°ò¥»°Ñ¼Æ¡A¦p¥]§tÄæ¦ì¡B§ó·sÀW²vµ¥
    - **¸ê®ÆRID**: ¸ê®Æ¶°
    - Â^¨ú½d¨Ò


JSON®æ¦¡ÀÉ®×
====================================
type:sub-section

- JSON (**J**ava**s**cript **O**bject **N**otation)
- »´¶q¯Åªº¸ê®Æ¥æ´«»y¨¥
- From **a**pplication **p**rogramming **i**nterfaces (APIs)
- JavaScript¡BJava¡BNode.jsÀ³¥Î
- ¤@¨ÇNoSQL¸ê®Æ®w¥ÎJSONÀx¦s¸ê®Æ¡G**MongoDB**
- [Wiki](http://en.wikipedia.org/wiki/JSON)

JSON¸ê®ÆÀx¦s®æ¦¡
====================================
- Numbers (double)
- Strings (double quoted)
- Boolean (_true_ or _false_)
- Array (ordered, comma separated enclosed in square brackets _[]_)
- Object (unorderd, comma separated collection of **key:value** pairs in curley brackets _{}_)

[JSONÀÉ®×½d¨Ò](https://api.github.com/users/yijutseng/repos)


JSONÀÉ®×¶×¤J
====================================
- `jsonlite` package (®M¥ó¨Ï¥Î«e¥²¶·¦w¸Ë)
- `fromJSON()`¨ç¼Æ¸ü¤JJSON¸ê®Æ
- ª½±µ±qAPIºô§}ºI¨ú¸ê®Æ: `RCurl` package
    - ¨Ï¥Î`getURL()`¨ç¼Æ³B²z¸ê®ÆÂ^¨úºô§}

```r
library(jsonlite)
library(RCurl)
PetData<-fromJSON(
    getURL("http://data.taipei/opendata/datalist/apiAccess?scope=resourceAquire&rid=f4a75ba9-7721-4363-884d-c3820b0b917c"))
```

JSONÀÉ®×¶×¤J
====================================
- Âà¦s¬°`¦Cªílist`ªº«¬ºA
- ¤­­Ó¤l¤¸¯À(offset, limit, count, sort, results)
- results¤l¤¸¯ÀªºÃþ§O¬°¸ê®Æ®Ødata.frame

```r
str(PetData)
```

```
List of 1
 $ result:List of 5
  ..$ offset : int 0
  ..$ limit  : int 10000
  ..$ count  : int 306
  ..$ sort   : chr ""
  ..$ results:'data.frame':	306 obs. of  20 variables:
  .. ..$ _id            : chr [1:306] "1" "2" "3" "4" ...
  .. ..$ Name           : chr [1:306] "" "" "" "" ...
  .. ..$ Sex            : chr [1:306] "»Û" "¶¯" "»Û" "»Û" ...
  .. ..$ Type           : chr [1:306] "¿ß" "¤ü" "¤ü" "¤ü" ...
  .. ..$ Build          : chr [1:306] "¤¤" "¥®" "¥®" "¥®" ...
  .. ..$ Age            : chr [1:306] "¦¨¦~" "¥®ÄÖ" "¥®ÄÖ" "¥®ÄÖ" ...
  .. ..$ Variety        : chr [1:306] "¦Ì§J´µ" "¦Ì§J´µ" "¦Ì§J´µ" "¦Ì§J´µ" ...
  .. ..$ Reason         : chr [1:306] "°Êª«ºÞ¨î" "°Êª«ºÞ¨î" "°Êª«ºÞ¨î" "°Êª«ºÞ¨î" ...
  .. ..$ AcceptNum      : chr [1:306] "106030212" "106030208" "106030206" "106030205" ...
  .. ..$ ChipNum        : chr [1:306] "" "" "" "" ...
  .. ..$ IsSterilization: chr [1:306] "¥¼µ´¨|" "¥¼µ´¨|" "¥¼µ´¨|" "¥¼µ´¨|" ...
  .. ..$ HairType       : chr [1:306] "¶Â" "©@°Ø" "¶Â" "¶Â´Ä" ...
  .. ..$ Note           : chr [1:306] "" "¥Ö½§¯f¡BÂÀª·®ð" "¥Ö½§¯f" "¥Ö½§¯f" ...
  .. ..$ Resettlement   : chr [1:306] "" "»O¥_¥«°Êª«¤§®a ¦¬®e½s¸¹106030208" "»O¥_¥«°Êª«¤§®a ¦¬®e½s¸¹106030206" "»O¥_¥«°Êª«¤§®a ¦¬®e½s¸¹106030205" ...
  .. ..$ Phone          : chr [1:306] "" "02-87913063" "02-8791-3062" "02-8791-3062" ...
  .. ..$ Email          : chr [1:306] "" "tcapoa8@mail.taipei.gov.tw" "tcapoa8@mail.taipei.gov.tw" "tcapoa8@mail.taipei.gov.tw" ...
  .. ..$ ChildreAnlong  : chr [1:306] "" "" "" "" ...
  .. ..$ AnimalAnlong   : chr [1:306] "" "" "" "" ...
  .. ..$ Bodyweight     : chr [1:306] "" "" "" "" ...
  .. ..$ ImageName      : chr [1:306] "http://163.29.39.183/uploads/images/medium/cd000c4b-e974-422c-9e03-f75a133a28d2.jpg" "http://163.29.39.183/uploads/images/medium/e8224fbd-651c-4fe1-bb43-61f7afa5a06d.jpg" "http://163.29.39.183/uploads/images/medium/0419cc40-2704-4aa1-80bd-e6c0170c7abc.jpg" "http://163.29.39.183/uploads/images/medium/69fbe932-2a4d-4645-aa34-a4273c25bd38.jpg" ...
```

JSONÀÉ®×¸ÑªR
====================================
- ¨Ï¥Î`$`²Å¸¹ºI¨ú¤¸¯À»P¤l¤¸¯À

```r
head(PetData$result$results)
```

```
  _id Name Sex Type Build  Age Variety       Reason AcceptNum
1   1       »Û   ¿ß    ¤¤ ¦¨¦~  ¦Ì§J´µ     °Êª«ºÞ¨î 106030212
2   2       ¶¯   ¤ü    ¥® ¥®ÄÖ  ¦Ì§J´µ     °Êª«ºÞ¨î 106030208
3   3       »Û   ¤ü    ¥® ¥®ÄÖ  ¦Ì§J´µ     °Êª«ºÞ¨î 106030206
4   4       »Û   ¤ü    ¥® ¥®ÄÖ  ¦Ì§J´µ     °Êª«ºÞ¨î 106030205
5   5 ¦h¦h  »Û   ¤ü    ¤¤ ¦¨¦~  ¦Ì§J´µ ¥Á²³¤£ÀÀÄò¾i 106030102
6   6 ¤ò²y  ¶¯   ¤ü    ¤¤ ¦¨¦~  ¦Ì§J´µ ¥Á²³¤£ÀÀÄò¾i 106030101
          ChipNum IsSterilization HairType
1                          ¥¼µ´¨|       ¶Â
2                          ¥¼µ´¨|     ©@°Ø
3                          ¥¼µ´¨|       ¶Â
4                          ¥¼µ´¨|     ¶Â´Ä
5 900073000086102          ¤wµ´¨|     ¶Â´Ä
6 900128001361287          ¤wµ´¨|       ¶Â
                                                                                                                   Note
1                                                                                                                      
2                                                                                                        ¥Ö½§¯f¡BÂÀª·®ð
3                                                                                                                ¥Ö½§¯f
4                                                                                                                ¥Ö½§¯f
5                                          ¥k«eºI³k\n¤j®a¦n~§Ú¬O¦h¦h¡A§Ú¤S¦^¨ì°Êª«¤§®a¤F~³ßÅw§Ú¥i¥H¨ì°Êª«¤§®a¬Ý¬Ý§Ú­ò!!
6 ¶Ù~§A¦b¬Ý§Ú¶Ü?§Úªº¦W¦r¥s¤ò²y¡A¤S¦^¨ì°Êª«¤§®aªº§Ú¡A§Æ±æ¤U­Ó¥D¤H¯à¦³¤j¤jªº¥Í¬¡Àô¹Ò¡A¯àÅý§ÚºÉ±¡ªº¶]¸õ§p¥s¡A¹L´r§Öªº¥Í¬¡!
                      Resettlement        Phone                      Email
1                                                                         
2 »O¥_¥«°Êª«¤§®a ¦¬®e½s¸¹106030208  02-87913063 tcapoa8@mail.taipei.gov.tw
3 »O¥_¥«°Êª«¤§®a ¦¬®e½s¸¹106030206 02-8791-3062 tcapoa8@mail.taipei.gov.tw
4 »O¥_¥«°Êª«¤§®a ¦¬®e½s¸¹106030205 02-8791-3062 tcapoa8@mail.taipei.gov.tw
5 »O¥_¥«°Êª«¤§®a ¦¬®e½s¸¹106030102                                        
6 »O¥_¥«°Êª«¤§®a ¦¬®e½s¸¹106030101  02-87913062 tcapoa8@mail.taipei.gov.tw
  ChildreAnlong AnimalAnlong Bodyweight
1                                      
2                                      
3                                      
4                                      
5                                      
6                                      
                                                                            ImageName
1 http://163.29.39.183/uploads/images/medium/cd000c4b-e974-422c-9e03-f75a133a28d2.jpg
2 http://163.29.39.183/uploads/images/medium/e8224fbd-651c-4fe1-bb43-61f7afa5a06d.jpg
3 http://163.29.39.183/uploads/images/medium/0419cc40-2704-4aa1-80bd-e6c0170c7abc.jpg
4 http://163.29.39.183/uploads/images/medium/69fbe932-2a4d-4645-aa34-a4273c25bd38.jpg
5 http://163.29.39.183/uploads/images/medium/7c994676-0b74-427a-81ad-3eed96a6db03.jpg
6 http://163.29.39.183/uploads/images/medium/241c31fd-e976-41db-94a7-de925fe7ddb9.jpg
```

JSONÀÉ®×¸ÑªR
====================================
¤ÀªR¦U¶µ**¶}©ñ»{¾i²z¥Ñ**¥X²{¦¸¼Æ

```r
table(PetData$result$results$Reason)
```

```

             ¥Á²³¤£ÀÀÄò¾i     ¥Á²³¬BÀò     °Êª«±Ï´©     °Êª«ºÞ¨î 
          26           46           21          101          112 
```
¤ÀªR¥iª¾¶}©ñ»{¾i²z¥Ñ¥H°Êª«ºÞ¨î»P¥¼¶ñ¼g©~¦h

JSONÀÉ®×¶×¤J½m²ß
====================================
type:alert
incremental:true

- ½m²ß¥Î¸ê®Æ¡G[¡u»O¥_¥«¤µ¤é¬I¤u¸ê°T¡vAPI¦s¨ú](http://data.taipei/opendata/datalist/datasetMeta/outboundDesc?id=4d29818c-a3ee-425d-b88a-22ac0c24c712&rid=201d8ae8-dffc-4d17-ae1f-e58d8a95b162)
- ¨Ï¥ÎÀÉ®×¶×¤J**½d¨Ò**¡A±N¸ê®Æ¶×¤JR¤¤
    - ´£¥Ü¡G**fromJSON**, **getURL**
- ¨Ï¥Îstr()¨ç¼ÆÀË¬d¶×¤Jªº¸ê®Æ
- ½Ð°Ý¤µ¤é¬I¤u¸ê®Æ¦³´Xµ§Æ[¹î­È¡H´X­ÓÄæ¦ì¡H

±N¸ê®Æ®ØÂà¬°JSON®æ¦¡
====================================
- `jsonlite` package
- `toJSON()` ¨ç¼Æ

```r
myjson <- toJSON(iris, pretty=TRUE)
str(myjson)
```

```
Class 'json'  chr "[\n  {\n    \"Sepal.Length\": 5.1,\n    \"Sepal.Width\": 3.5,\n    \"Petal.Length\": 1.4,\n    \"Petal.Width\": 0.2,\n    \"Spe"| __truncated__
```

XML ¥i©µ¦ù¼Ð°O¦¡»y¨¥
====================================
type:sub-section

- E**x**tensible **m**arkup **l**anguage
- ´y­z**µ²ºc¤Æ**¸ê®Æªº»y¨¥
- ³B²zXMLÀÉ®×¬Oºô­¶**Html**ª¦ÂÎªº°òÂ¦
- Components
    - Markup ¼Ð°O - labels that give the text structure
    - Content ¤º¤å - the actual text of the document
- [XML Wiki](https://zh.wikipedia.org/wiki/XML)

XML ¥i©µ¦ù¼Ð°O¦¡»y¨¥
====================================
Tags, elements and attributes

- Tags correspond to general labels
    - Start tags `<breakfast_menu>`, `<price>`
    - End tags `</breakfast_menu>`,`</price>`
    - Empty tags `<line-break />`
- Elements are specific examples of tags
    - `<name>Belgian Waffles</name>`
- Attributes are components of the label
    - `<book category="web">`
    
XML ¥i©µ¦ù¼Ð°O¦¡»y¨¥-Åª¨ú
====================================
- [»O¥_¥«¤ô½èºÊ´ú¸ê°T](http://data.taipei/opendata/datalist/datasetMeta/download?id=961ca397-4a59-45e8-b312-697f26b059dc&rid=190796c8-7c56-42e0-8068-39242b8ec927)
- ¦w¸Ë`XML` package
- `xmlTreeParse()`¨ç¼Æ±NXMLÀÉ®×¶×¤J


```r
library(XML)
waterQ <- xmlTreeParse("http://data.taipei/opendata/datalist/datasetMeta/download?id=961ca397-4a59-45e8-b312-697f26b059dc&rid=190796c8-7c56-42e0-8068-39242b8ec927",useInternal=TRUE)
rootNode <- xmlRoot(waterQ) #access the top node
```


xpath?
====================================
- XML¸ô®|»y¨¥¡]XML Path Language¡^
- °ò©óXMLªº¾ðª¬µ²ºc¡A´£¨Ñ¦b¸ê®Æµ²ºc¾ð¤¤§ä´M¸`ÂIªº¯à¤O
- [ºû°ò¦Ê¬ì](https://zh.wikipedia.org/wiki/XPath)

XML ¥i©µ¦ù¼Ð°O¦¡»y¨¥-¸ÑªR
====================================
¨Ï¥Î`xpathSApply()`¨ç¼Æ¨ú±o«ü©w¼ÐÅÒ¤ºªº¸ê®Æ

```r
#¨ú±o©Ò¦³"code_name"¼ÐÅÒ¤ºªº¸ê®Æ
xpathSApply(rootNode,"//code_name",xmlValue)[1:10]
```

```
 [1] "Âù·Ë²b¤ô³õ"               "½Ã²z¤k¤¤"                
 [3] "Âù·Ë°ê¤p                " "µØ¿³¥[À£¯¸"              
 [5] "ªø¿³²b¤ô³õ"               "¥«¬F¤j¼Ó"                
 [7] "¥«Ä³·|"                   "±¶¹B©¾§µ´_¿³¯¸"          
 [9] "«n´ä°ª¤u"                 "«n´ä¥[À£¯¸"              
```

XML ¥i©µ¦ù¼Ð°O¦¡»y¨¥-¸ÑªR
====================================
¨Ï¥Î`xpathSApply()`¨ç¼Æ¨ú±o«ü©w¼ÐÅÒ¤ºªº¸ê®Æ

```r
#¨ú±o¦UºÊ´ú¯¸ªº¸g«×
xpathSApply(rootNode,"//longitude",xmlValue)[1:10]
```

```
 [1] "121.56094" "121.54401" "121.55557" "121.53476" "121.54043"
 [6] "121.55661" "121.55360" "121.53551" "121.59892" "121.60829"
```

XMLÀÉ®×¶×¤J½m²ß
====================================
type:alert
incremental:true
- ¸ü¤J[®ç¶é±¶¹B¨®¯¸¥X¤J¤f°ò¥»¸ê®Æ](http://data.tycg.gov.tw/opendata/datalist/datasetMeta/download?id=b2653545-9425-46df-9a50-74ade59ab0cf&rid=f6362ce8-719b-4752-bec6-7fd995b623fd)
- ¹Á¸Õ¨ú±o¦U¯¸¥X¤J¤f±Ô­z(LocationDescription)»P¸g½n«×(PositionLon,PositionLat)

ºô­¶ª¦ÂÎ Webscraping
====================================
type:sub-section

- ¤£¬O¨C­Óºô¯¸³£´£¨ÑAPI
- ¤H¤u½Æ»s¶K¤W?!
- µ{¦¡¤Æªº¤è¦¡Â^¨úºô­¶¸ê®Æ: **ºô­¶ª¦ÂÎ¡]Webscraping¡^**¡][Webscraping Wiki](http://en.wikipedia.org/wiki/Web_scraping)¡^
- ¥i¯à¯Ó¶O«Ü¦hºô­¶¬y¶q©M¸ê·½ ¡Ð«Ü¥i¯à³QÂêIP
- ¦bRªº³B²z¿ìªk
    - ·í§@XMLÀÉ®×³B²z¤ÀªR
    - ¨Ï¥Î`rvest` package»²§U


ºô­¶ª¦ÂÎ Webscraping-³v¦æÅª¨ú
====================================

- ª½±µ³v¦æÅª¨ú `readLines()`


```r
con <- url("http://im.cgu.edu.tw/bin/home.php")
htmlCode <-readLines(con)
close(con)
htmlCode[1:5]
```

```
[1] "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">"                                                             
[2] "<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"zh-tw\">"                                                                                                                              
[3] "<head>"                                                                                                                                                                                    
[4] "<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />"                                                                                                                 
[5] "<meta http-equiv=\"X-UA-Compatible\" content=\"IE=EmulateIE7\" /><meta name=\"keywords\" content=\"è«‹å¡«å¯«ç¶²ç«™é\x97œéµè¨˜ä\xba‹ï\xbcŒç”¨\xe5\x8dŠè\xa7’é\u0080—è\x99\x9f(,)\xe9\x9a”é\x96\x8b\" />"
```

ºô­¶ª¦ÂÎ Webscraping-³v¦æÅª¨ú
====================================
Åª¨ú§¹ºô­¶«á¡A¨Ï¥ÎXML¤u¨ã¤ÀªRÂ^¨úºô­¶ (`XML` package)


```r
library(httr)
html <- htmlTreeParse(GET("http://im.cgu.edu.tw/bin/home.php"), useInternalNodes=T)
xpathSApply(html, "//title", xmlValue)
```

```
[1] "ªø©°¤j¾Ç ¸ê°TºÞ²z¾Ç¨t "
```

ºô­¶ª¦ÂÎ Webscraping-³v¦æÅª¨ú
====================================
Åª¨ú§¹ºô­¶«á¡A¨Ï¥Î¥ÎXML¤u¨ã»Pxpath¤ÀªRÂ^¨úºô­¶ (`XML` package)

```r
xpathSApply(html, "//span[@class='ptname ']", xmlValue)
```

```
 [1] "²¦·~±MÃD¦¨ªG®i"       "ºÓ¤h¯Z­pµe®Ñ¼f¬d"     "²¦·~®Õ¤Í¸ê®Æµn¿ý"    
 [4] "ªø©°¤j¾Ç­º­¶"         "®Õ°È¸ê°T¨t²Î"         "¤H¨Æ±Ð¨|°V½m¸ê°Tºô"  
 [7] "°ê¤º¸êºÞ¨t©Ò"         "ºÓ³Õ¤h½×¤åºô"         "¸êºÞ¨t¤º³¡¦æ¬F¨t²Î"  
[10] "¸êºÞ¨t¤À¾÷ªí"         "¸êºÞ¨t¾Ç·|"           "TA½Ò«á»²¾É­È¯Zªí"    
[13] "¾Ç¥Íwebmail"          "¤u°ÓºÞ²z¾Ç¨t/¬ã¨s©Ò"  "¤u·~³]­p¾Ç¨t/¬ã¨s©Ò" 
[16] "ºÞ²z¾Ç°|"             "Âå°ÈºÞ²z¾Ç¨t/¬ã¨s©Ò"  "°ÓºÞ±M·~¾Ç°|"        
[19] "¥ø·~ºÞ²z¬ã¨s©Ò³Õ¤h¯Z" "ªø©°¤j¾Ç¦æ¨Æ¾ä"      
```

ºô­¶ª¦ÂÎ Webscraping-rvest
====================================
¸ü¤J`rvest`®M¥ó«á¡A¸g¥Ñ¥H¤U¨BÆJ¶i¦æºô¯¸¸ÑªR¡G

- ¨Ï¥Î`read_html(¡§±ýÂ^¨úªººô¯¸ºô§}¡¨)`¨ç¼ÆÅª¨úºô­¶
- ¨Ï¥Î`html_nodes()`¨ç¼ÆÂ^¨ú©Ò»Ý¤º®e (±ø¥ó¬°CSS©Îxpath¼ÐÅÒ)
- ¨Ï¥Î`html_text()`¨ç¼Æ³B²z/²M¬~Â^¨ú¤º®e¡A¯d¤U»Ý­nªº¸ê®Æ
- ¨Ï¥Î`html_attr()`¨ç¼ÆÂ^¨ú¸ê®Æ°Ñ¼Æ¡]¦p³sµ²url¡^

ºô­¶ª¦ÂÎ Webscraping-rvest
====================================

```r
library(rvest) ##¸ü¤J
YahooNewsurl<-"https://tw.news.yahoo.com/"
news_title <- read_html(YahooNewsurl) %>% html_nodes(".tpl-title a") %>% html_text()
news_url <- read_html(YahooNewsurl) %>% html_nodes(".tpl-title a") %>% html_attr("href")
Yahoo_news <- data.frame(title = news_title, url=news_url)
head(Yahoo_news)
```

```
                                    title                                                           url
1         ´¿1©d5©c¦n­·¥ú ¨k¬PºG½æ»¨¦vÁÙ¶Å /±q1©d5©cªº­·¥ú¨ìÅÜ½æ»¨¦vÁÙ¶Å-ºô¤Í¼N¹p¬x¡G¬¡¸Ó-091741737.html
2          ¬ü³ø§i¡G¬ü±ó¡u¤@¤¤¡v¥xÆW§ó¦MÀI               /¬ü³ø§i-¬ü©ß±ó-¤¤-¥xÆW³B¹Ò§ó¦MÀI-081036215.html
3           ÂÅ¦â­á¿»Á¦¡I1±i¹Ï¬Ý´H¬y¦³¦h§N       /ÅQ¤ý¯Å´H¬y¦AÅ§¥x-±i¹Ï¬ÝÀ´³oªi´H¬y¦³¦h±j-101500692.html
4           ¥L³Q©d¤lÀ¹ºñ´U ¹ï¶H³º¬O¿Ë§Ì§Ì                 /¥L³Q©d¤lÀ¹ºñ´U-¹ï¶H³º¬O¿Ë§Ì§Ì-072010033.html
5               ¥^¦£±À¥X²¾¥Á¸T¥O ¥L«á®¬¤F           /¥^¦£±À²¾¥Á¸T¥O-¬ü°ê¤g¦w¥þ³¡ªøªí«á®¬-044517088.html
6 ½²¬F©²¹ï³¨³½¥xºA«× °ê¥ÁÄÒ¼~¬ü¤é¦w«O½èÅÜ       /½²¬F©²¹ï³¨³½¥xºA«×-°ê¥ÁÄÒ¼~¬ü¤é¦w«O½èÅÜ-160200179.html
```

ºô­¶ª¦ÂÎ Webscraping-rvest
====================================
- Â^¨ú±ø¥óªº¼¶¼g·|¦]ºô­¶»yªk¤£¦P¦Ó¦³®t²§
- ¨Ï¥Î**Google Chrome¶}µo¤u¨ã**»²§UÆ[¹îÂ^¨ú¸ê®Æªº±ø¥ó
- ¨Ï¥Î**xpath-helper**»²§Uxpath¼ÐÅÒªºÂ^¨ú
- Æ[¹î»Ý­nÂ^¨úªº¸ê®Æ©Ò¦bHTML¤ù¬q
    - ·s»D²M³æ³Q¥]§t¦b`ul`¼ÐÅÒ¤U
    - ¥Bcss class¬°`tpl-title yom-list list-style-none`

```
<ul class="tpl-title yom-list list-style-none" id="yui_3_9_1_1_1486568229946_2408">
<li class="list-story first" id="yui_3_9_1_1_1486568229946_2407">
<div class="txt" id="yui_3_9_1_1_1486568229946_2406">
<a href="/±q1©d5©cªº­·¥ú¨ìÅÜ½æ»¨¦vÁÙ¶Å-ºô¤Í¼N¹p¬x¡G¬¡¸Ó-091741737.html" class="title " data-ylk="pkg:96a0ca11-47bc-3100-81ad-0a288707f150;ver:60cdb126-ee0c-11e6-bb9b-8a777738a932;lt:i;pos:1;" data-rapid_p="1">´¿1©d5©c¦n­·¥ú ¨k¬PºG½æ»¨¦vÁÙ¶Å</a>
<cite id="yui_3_9_1_1_1486568229946_2405">
<span class="provider" id="yui_3_9_1_1_1486568229946_2404">Yahoo©_¼¯®T¼Ö·s»D</span>
</cite></div></li>
....
```

ºô­¶ª¦ÂÎ DCard¹ê§@ -1
====================================
(ª¦ÂÎµ²ªG¤£¥Nªí¥»¤H·N¨£)

```r
library(rvest) ##¸ü¤J
DCardCGU<-"https://www.dcard.tw/f/cgu?latest=true"
DCardContent<-read_html(DCardCGU)
post_title <- DCardContent %>% html_nodes(".PostEntry_titleUnread_ycJL0") %>% html_text()
post_contentShort<- DCardContent %>% html_nodes(".PostEntry_excerpt_A0Bmh") %>% html_text()
post_author<- DCardContent %>% html_nodes(".PostAuthor_root_3vAJf") %>% html_text()
post_comment<- DCardContent %>% html_nodes(".PostEntry_commentUnread_1cVyd") %>% html_text()
```

ºô­¶ª¦ÂÎ DCard¹ê§@ -2
====================================
(ª¦ÂÎµ²ªG¤£¥Nªí¥»¤H·N¨£)



























```
Error in sort.list(y) : ¦b 'utf8towcs' ¤¤µL®Äªº¿é¤J'æ™ºæ…§è²¡ç”¢æ¬ŠðŸ’¦'
```
